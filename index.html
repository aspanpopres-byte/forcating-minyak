<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Forecasting Minyak Kelapa Sawit</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(to right, #2d5016, #4a7c3a);
            color: white;
            padding: 20px 0;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
        }
        
        h1 {
            font-size: 2rem;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        
        .user-info i {
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            display: none;
            z-index: 100;
            overflow: hidden;
        }
        
        .user-dropdown.active {
            display: block;
        }
        
        .user-dropdown-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333;
            text-decoration: none;
            border-bottom: 1px solid #eee;
            transition: background-color 0.3s;
        }
        
        .user-dropdown-item:hover {
            background-color: #f8f9fa;
        }
        
        .user-dropdown-item:last-child {
            border-bottom: none;
        }
        
        .user-dropdown-item.logout {
            color: #f44336;
        }
        
        .user-role {
            background-color: #ff9800;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 5px;
        }
        
        .content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 25px;
        }
        
        .sidebar {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            height: fit-content;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .card {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
        
        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: #2d5016;
            font-size: 1.3rem;
        }
        
        .card-title i {
            font-size: 1.5rem;
        }
        
        .nav-menu {
            list-style: none;
            margin-top: 20px;
        }
        
        .nav-item {
            margin-bottom: 15px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            text-decoration: none;
            color: #333;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover, .nav-link.active {
            background-color: #e9f5e1;
            color: #2d5016;
            font-weight: 600;
        }
        
        .nav-link i {
            width: 20px;
            text-align: center;
        }
        
        .nav-link .badge {
            margin-left: auto;
            background-color: #ff9800;
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
        }
        
        .stat-info h3 {
            font-size: 1.8rem;
            color: #2d5016;
        }
        
        .stat-info p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .icon-1 { background-color: #4a7c3a; }
        .icon-2 { background-color: #7cb342; }
        .icon-3 { background-color: #9ccc65; }
        .icon-4 { background-color: #c5e1a5; }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #7cb342;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #4a7c3a;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #3a652a;
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #e0e0e0;
        }
        
        .btn-danger {
            background-color: #f44336;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #d32f2f;
        }
        
        .btn-success {
            background-color: #4caf50;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #388e3c;
        }
        
        .btn-info {
            background-color: #2196f3;
            color: white;
        }
        
        .btn-info:hover {
            background-color: #1976d2;
        }
        
        .btn-warning {
            background-color: #ff9800;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #f57c00;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .chart-container {
            height: 400px;
            margin-top: 20px;
            position: relative;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2d5016;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .table-actions {
            display: flex;
            gap: 5px;
        }
        
        .table-actions .btn {
            padding: 6px 10px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .accuracy-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .high-accuracy {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .medium-accuracy {
            background-color: #fff3e0;
            color: #f57c00;
        }
        
        .low-accuracy {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .role-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .role-admin {
            background-color: #f44336;
            color: white;
        }
        
        .role-manager {
            background-color: #2196f3;
            color: white;
        }
        
        .role-analyst {
            background-color: #4caf50;
            color: white;
        }
        
        .role-viewer {
            background-color: #9e9e9e;
            color: white;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #2d5016;
            border-bottom: 3px solid #4a7c3a;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .forecast-methods {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .method-card {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .method-card:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .method-card h4 {
            color: #2d5016;
            margin-bottom: 10px;
        }
        
        .method-card p {
            color: #666;
            font-size: 0.95rem;
            margin-bottom: 15px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.3rem;
            color: #2d5016;
        }
        
        .close-modal {
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 20px;
        }
        
        .empty-state h3 {
            color: #888;
            margin-bottom: 10px;
        }
        
        .empty-state p {
            max-width: 400px;
            margin: 0 auto 20px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #ddd;
        }
        
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #2d5016 0%, #4a7c3a 100%);
            padding: 20px;
        }
        
        .login-box {
            background-color: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo i {
            font-size: 3rem;
            color: #4a7c3a;
            margin-bottom: 15px;
        }
        
        .login-title {
            color: #2d5016;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-footer {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.85rem;
        }
        
        .access-control {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .access-list {
            list-style: none;
            margin-top: 15px;
        }
        
        .access-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        
        .access-list li:last-child {
            border-bottom: none;
        }
        
        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
            }
            
            .main-content {
                order: 1;
            }
        }
        
        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .table-actions {
                flex-direction: column;
            }
            
            .user-dropdown {
                position: fixed;
                top: auto;
                bottom: 0;
                left: 0;
                right: 0;
                border-radius: 15px 15px 0 0;
            }
        }
        
        @media (max-width: 480px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen (Awal) -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <i class="fas fa-oil-can"></i>
                <h1 class="login-title">Sistem Forecasting Minyak Kelapa Sawit</h1>
                <p class="login-subtitle">Silakan login untuk mengakses sistem</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Masukkan username" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Masukkan password" required>
                </div>
                
                <div class="form-group">
                    <label for="role">Login sebagai</label>
                    <select id="role" required>
                        <option value="">Pilih role</option>
                        <option value="admin">Administrator</option>
                        <option value="manager">Manager</option>
                        <option value="analyst">Analyst</option>
                        <option value="viewer">Viewer</option>
                    </select>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </div>
                
                <div class="login-footer">
                    <p>Gunakan kredensial berikut untuk testing:</p>
                    <p><strong>Admin:</strong> admin / admin123</p>
                    <p><strong>Manager:</strong> manager / manager123</p>
                    <p><strong>Analyst:</strong> analyst / analyst123</p>
                    <p><strong>Viewer:</strong> viewer / viewer123</p>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Main App (Setelah Login) -->
    <div id="mainApp" class="container" style="display: none;">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-oil-can"></i>
                    <div>
                        <h1>Sistem Forecasting Minyak Kelapa Sawit</h1>
                        <div class="subtitle">Perencanaan dan Prediksi Produksi Kelapa Sawit</div>
                    </div>
                </div>
                <div class="user-info">
                    <div>
                        <span id="currentUserName">Admin Perkebunan</span>
                        <span id="currentUserRole" class="user-role">Admin</span>
                    </div>
                    <i class="fas fa-user-circle" id="userDropdownToggle"></i>
                    <div class="user-dropdown" id="userDropdown">
                        <a href="#" class="user-dropdown-item" data-tab="profile">
                            <i class="fas fa-user"></i> Profil Saya
                        </a>
                        <a href="#" class="user-dropdown-item" data-tab="settings">
                            <i class="fas fa-cog"></i> Pengaturan
                        </a>
                        <a href="#" class="user-dropdown-item" data-tab="user-management" id="userManagementMenuItem" style="display: none;">
                            <i class="fas fa-users-cog"></i> Manajemen User
                        </a>
                        <a href="#" class="user-dropdown-item" data-tab="system-logs" id="systemLogsMenuItem" style="display: none;">
                            <i class="fas fa-history"></i> Log Sistem
                        </a>
                        <div class="user-dropdown-item logout" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="content">
            <aside class="sidebar">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-bars"></i> Menu Utama
                    </h2>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="#" class="nav-link active" data-tab="dashboard">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-tab="data-input" id="dataInputMenuItem">
                                <i class="fas fa-database"></i> Input Data Produksi
                                <span class="badge" id="dataInputBadge" style="display: none;">Restricted</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-tab="forecasting">
                                <i class="fas fa-chart-line"></i> Forecasting
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-tab="methods">
                                <i class="fas fa-cogs"></i> Metode Forecasting
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-tab="analysis">
                                <i class="fas fa-chart-bar"></i> Analisis Akurasi
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-tab="reports" id="reportsMenuItem">
                                <i class="fas fa-file-export"></i> Laporan
                                <span class="badge" id="reportsBadge" style="display: none;">Restricted</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-tab="user-management" id="userManagementSideMenuItem" style="display: none;">
                                <i class="fas fa-users-cog"></i> Manajemen User
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-tab="system-logs" id="systemLogsSideMenuItem" style="display: none;">
                                <i class="fas fa-history"></i> Log Sistem
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="card" style="margin-top: 20px;">
                    <h2 class="card-title">
                        <i class="fas fa-info-circle"></i> Informasi Sistem
                    </h2>
                    <p style="font-size: 0.95rem; color: #666; margin-bottom: 15px;">
                        Anda login sebagai: <strong id="sidebarRole">Admin</strong>
                    </p>
                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 15px;">
                        <i class="fas fa-calendar-check" style="color: #4a7c3a;"></i>
                        <span>Data Terakhir: <span id="sidebarLastData">-</span></span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                        <i class="fas fa-sync-alt" style="color: #4a7c3a;"></i>
                        <span>Status: <span id="sidebarStatus">Aktif</span></span>
                    </div>
                </div>
            </aside>
            
            <main class="main-content">
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-icon icon-1">
                            <i class="fas fa-oil-can"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="statAvgProduction">-</h3>
                            <p>Ton (Rata-rata Produksi/Bulan)</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon icon-2">
                            <i class="fas fa-seedling"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="statGrowth">-</h3>
                            <p>Pertumbuhan (YoY)</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon icon-3">
                            <i class="fas fa-bullseye"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="statAccuracy">-</h3>
                            <p>Akurasi Forecasting</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon icon-4">
                            <i class="fas fa-chart-area"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="statPeriod">12 Bulan</h3>
                            <p>Periode Peramalan</p>
                        </div>
                    </div>
                </div>
                
                <!-- Dashboard Tab -->
                <div id="dashboard" class="card tab-content active">
                    <h2 class="card-title">
                        <i class="fas fa-tachometer-alt"></i> Dashboard Forecasting
                    </h2>
                    <p>Visualisasi data historis produksi minyak kelapa sawit dan prediksi untuk 12 bulan ke depan.</p>
                    
                    <div class="tabs">
                        <div class="tab active" data-chart="overview">Overview</div>
                        <div class="tab" data-chart="seasonal">Analisis Musiman</div>
                        <div class="tab" data-chart="comparison">Perbandingan Metode</div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="forecastChart"></canvas>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3 style="color: #2d5016; margin-bottom: 15px;">Rekomendasi Berdasarkan Forecast</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
                            <div style="background-color: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid #4a7c3a;">
                                <h4 style="color: #2d5016; margin-bottom: 5px;">Perencanaan Produksi</h4>
                                <p style="font-size: 0.9rem; color: #555;" id="recommendation1">Tambahkan data produksi untuk mendapatkan rekomendasi.</p>
                            </div>
                            <div style="background-color: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid #2196f3;">
                                <h4 style="color: #1565c0; margin-bottom: 5px;">Manajemen Stok</h4>
                                <p style="font-size: 0.9rem; color: #555;" id="recommendation2">Input data historis untuk analisis kebutuhan penyimpanan.</p>
                            </div>
                            <div style="background-color: #fff3e0; padding: 15px; border-radius: 8px; border-left: 4px solid #ff9800;">
                                <h4 style="color: #e65100; margin-bottom: 5px;">Perawatan Mesin</h4>
                                <p style="font-size: 0.9rem; color: #555;" id="recommendation3">Data diperlukan untuk jadwal perawatan optimal.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Data Input Tab -->
                <div id="data-input" class="card tab-content">
                    <div id="dataInputRestricted" class="empty-state" style="display: none;">
                        <i class="fas fa-lock"></i>
                        <h3>Akses Dibatasi</h3>
                        <p>Anda tidak memiliki izin untuk mengakses fitur Input Data Produksi. Hanya Admin, Manager, dan Analyst yang dapat mengakses fitur ini.</p>
                        <p>Role Anda saat ini: <strong id="currentRoleDisplay">Viewer</strong></p>
                        <button class="btn btn-secondary" id="backToDashboardFromInput">
                            <i class="fas fa-arrow-left"></i> Kembali ke Dashboard
                        </button>
                    </div>
                    
                    <div id="dataInputContent">
                        <h2 class="card-title">
                            <i class="fas fa-database"></i> Input Data Produksi
                        </h2>
                        <p>Masukkan data produksi minyak kelapa sawit untuk memperbarui dataset forecasting.</p>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px;">
                            <div>
                                <h3 style="color: #2d5016; margin-bottom: 20px;">Form Input Data</h3>
                                <form id="dataForm">
                                    <input type="hidden" id="editIndex" value="-1">
                                    <div class="form-group">
                                        <label for="period">Periode (Bulan-Tahun)</label>
                                        <input type="month" id="period" value="2023-07" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="production">Produksi (Ton)</label>
                                        <input type="number" id="production" step="0.01" min="0" placeholder="Contoh: 2450.50" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="rainfall">Curah Hujan (mm)</label>
                                        <input type="number" id="rainfall" step="0.1" min="0" placeholder="Contoh: 150.5">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="temperature">Suhu Rata-rata (Â°C)</label>
                                        <input type="number" id="temperature" step="0.1" min="0" placeholder="Contoh: 27.5">
                                    </div>
                                    
                                    <div class="btn-group">
                                        <button type="submit" class="btn btn-primary" id="submitBtn">
                                            <i class="fas fa-save"></i> Simpan Data
                                        </button>
                                        <button type="button" id="cancelEdit" class="btn btn-secondary" style="display: none;">
                                            <i class="fas fa-times"></i> Batal Edit
                                        </button>
                                        <button type="button" id="resetForm" class="btn btn-secondary">
                                            <i class="fas fa-redo"></i> Reset
                                        </button>
                                    </div>
                                </form>
                                
                                <div style="margin-top: 30px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
                                    <h4 style="color: #2d5016; margin-bottom: 10px;">Panduan Input Data</h4>
                                    <ul style="color: #666; padding-left: 20px; font-size: 0.9rem;">
                                        <li>Pastikan periode data sesuai dengan bulan dan tahun produksi</li>
                                        <li>Data produksi dalam satuan ton (contoh: 2450.50)</li>
                                        <li>Curah hujan dan suhu opsional, namun membantu meningkatkan akurasi forecasting</li>
                                        <li>Minimal input 6 bulan data untuk forecasting yang akurat</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div>
                                <h3 style="color: #2d5016; margin-bottom: 20px;">Data Historis Produksi</h3>
                                <div style="max-height: 400px; overflow-y: auto;">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Periode</th>
                                                <th>Produksi (Ton)</th>
                                                <th>Curah Hujan</th>
                                                <th>Suhu</th>
                                                <th>Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody id="dataTable">
                                            <!-- Data akan diisi oleh JavaScript, saat ini kosong -->
                                        </tbody>
                                    </table>
                                    <div id="emptyTableMessage" class="empty-state">
                                        <i class="fas fa-database"></i>
                                        <h3>Tidak Ada Data</h3>
                                        <p>Belum ada data produksi yang dimasukkan. Gunakan form di sebelah kiri untuk menambahkan data pertama Anda.</p>
                                        <button id="addSampleData" class="btn btn-primary">
                                            <i class="fas fa-plus"></i> Tambah Data Contoh
                                        </button>
                                    </div>
                                </div>
                                <div style="margin-top: 20px; text-align: right;">
                                    <button id="importData" class="btn btn-secondary">
                                        <i class="fas fa-file-import"></i> Import Data CSV
                                    </button>
                                    <button id="exportData" class="btn btn-primary" disabled>
                                        <i class="fas fa-file-export"></i> Export Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Forecasting Tab -->
                <div id="forecasting" class="card tab-content">
                    <h2 class="card-title">
                        <i class="fas fa-chart-line"></i> Forecasting Produksi
                    </h2>
                    <p>Lakukan peramalan produksi minyak kelapa sawit dengan parameter yang dapat disesuaikan.</p>
                    
                    <div id="forecastingEmptyState" class="empty-state" style="display: none;">
                        <i class="fas fa-chart-line"></i>
                        <h3>Data Historis Diperlukan</h3>
                        <p>Untuk melakukan forecasting, Anda perlu menambahkan data historis produksi terlebih dahulu di tab "Input Data Produksi".</p>
                        <button id="goToInputData" class="btn btn-primary">
                            <i class="fas fa-database"></i> Ke Input Data
                        </button>
                    </div>
                    
                    <div id="forecastingContent">
                        <div style="display: grid; grid-template-columns: 300px 1fr; gap: 30px; margin-top: 20px;">
                            <div>
                                <h3 style="color: #2d5016; margin-bottom: 20px;">Parameter Forecasting</h3>
                                <div class="form-group">
                                    <label for="method">Metode Forecasting</label>
                                    <select id="method">
                                        <option value="moving-average">Moving Average (3 bulan)</option>
                                        <option value="exponential-smoothing">Exponential Smoothing</option>
                                        <option value="linear-regression">Regresi Linear</option>
                                        <option value="holt-winters">Holt-Winters</option>
                                        <option value="arima">ARIMA</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="periods">Periode Peramalan (Bulan)</label>
                                    <input type="number" id="periods" min="1" max="24" value="12">
                                </div>
                                
                                <div class="form-group">
                                    <label for="confidence">Tingkat Kepercayaan (%)</label>
                                    <input type="number" id="confidence" min="80" max="99" value="95">
                                </div>
                                
                                <div class="btn-group">
                                    <button id="runForecast" class="btn btn-primary">
                                        <i class="fas fa-play"></i> Jalankan Forecasting
                                    </button>
                                    <button id="saveForecast" class="btn btn-secondary">
                                        <i class="fas fa-save"></i> Simpan Hasil
                                    </button>
                                </div>
                                
                                <div style="margin-top: 30px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
                                    <h4 style="color: #2d5016; margin-bottom: 10px;">Info Metode</h4>
                                    <p id="methodInfo" style="font-size: 0.9rem; color: #666;">
                                        Moving Average: Metode sederhana dengan rata-rata bergerak untuk data dengan pola stabil.
                                    </p>
                                </div>
                            </div>
                            
                            <div>
                                <h3 style="color: #2d5016; margin-bottom: 20px;">Hasil Forecasting</h3>
                                <div class="chart-container">
                                    <canvas id="forecastResultChart"></canvas>
                                </div>
                                
                                <div style="margin-top: 30px;">
                                    <h4 style="color: #2d5016; margin-bottom: 10px;">Detail Peramalan</h4>
                                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                                        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px;">
                                            <p style="font-size: 0.9rem; color: #666;">Bulan dengan Produksi Tertinggi</p>
                                            <h4 style="color: #2d5016;" id="forecastHighestMonth">-</h4>
                                            <p style="font-size: 0.9rem; color: #666;" id="forecastHighestValue">- Ton</p>
                                        </div>
                                        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px;">
                                            <p style="font-size: 0.9rem; color: #666;">Total Produksi (12 Bulan)</p>
                                            <h4 style="color: #2d5016;" id="forecastTotalProduction">- Ton</h4>
                                            <p style="font-size: 0.9rem; color: #666;" id="forecastGrowth">- dari periode sebelumnya</p>
                                        </div>
                                        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px;">
                                            <p style="font-size: 0.9rem; color: #666;">Rekomendasi Metode</p>
                                            <h4 style="color: #2d5016;" id="forecastBestMethod">-</h4>
                                            <p style="font-size: 0.9rem; color: #666;" id="forecastBestAccuracy">Akurasi: -</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Methods Tab -->
                <div id="methods" class="card tab-content">
                    <h2 class="card-title">
                        <i class="fas fa-cogs"></i> Metode Forecasting
                    </h2>
                    <p>Pilih metode forecasting yang paling sesuai dengan pola data produksi minyak kelapa sawit Anda.</p>
                    
                    <div class="forecast-methods">
                        <div class="method-card">
                            <h4>Moving Average</h4>
                            <p>Metode sederhana yang menggunakan rata-rata dari sejumlah periode terakhir untuk meramalkan periode berikutnya.</p>
                            <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                                <span class="accuracy-badge high-accuracy">Akurasi: 92%</span>
                                <button class="btn btn-primary select-method-btn" data-method="moving-average">
                                    Pilih
                                </button>
                            </div>
                        </div>
                        
                        <div class="method-card">
                            <h4>Exponential Smoothing</h4>
                            <p>Memberikan bobot lebih besar pada data terbaru dengan faktor smoothing yang dapat disesuaikan.</p>
                            <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                                <span class="accuracy-badge high-accuracy">Akurasi: 94%</span>
                                <button class="btn btn-primary select-method-btn" data-method="exponential-smoothing">
                                    Pilih
                                </button>
                            </div>
                        </div>
                        
                        <div class="method-card">
                            <h4>Regresi Linear</h4>
                            <p>Mengidentifikasi hubungan linear antara waktu dan produksi untuk proyeksi masa depan.</p>
                            <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                                <span class="accuracy-badge medium-accuracy">Akurasi: 87%</span>
                                <button class="btn btn-primary select-method-btn" data-method="linear-regression">
                                    Pilih
                                </button>
                            </div>
                        </div>
                        
                        <div class="method-card">
                            <h4>Holt-Winters</h4>
                            <p>Metode yang memperhitungkan trend dan musiman dalam data, cocok untuk data dengan pola berulang.</p>
                            <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                                <span class="accuracy-badge high-accuracy">Akurasi: 96%</span>
                                <button class="btn btn-primary select-method-btn" data-method="holt-winters">
                                    Pilih
                                </button>
                            </div>
                        </div>
                        
                        <div class="method-card">
                            <h4>ARIMA</h4>
                            <p>Metode statistik canggih yang memodelkan autokorelasi dalam data untuk peramalan jangka pendek dan menengah.</p>
                            <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                                <span class="accuracy-badge high-accuracy">Akurasi: 95%</span>
                                <button class="btn btn-primary select-method-btn" data-method="arima">
                                    Pilih
                                </button>
                            </div>
                        </div>
                        
                        <div class="method-card">
                            <h4>Machine Learning</h4>
                            <p>Menggunakan algoritma machine learning seperti Random Forest atau Neural Network untuk peramalan yang lebih akurat.</p>
                            <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                                <span class="accuracy-badge high-accuracy">Akurasi: 97%</span>
                                <button class="btn btn-primary select-method-btn" data-method="machine-learning">
                                    Pilih
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3 style="color: #2d5016; margin-bottom: 15px;">Panduan Pemilihan Metode</h3>
                        <p style="color: #666; margin-bottom: 15px;">Pilih metode forecasting berdasarkan karakteristik data Anda:</p>
                        <ul style="color: #666; padding-left: 20px;">
                            <li><strong>Moving Average</strong>: Cocok untuk data dengan pola stabil tanpa trend atau musiman</li>
                            <li><strong>Exponential Smoothing</strong>: Baik untuk data dengan sedikit noise dan tanpa pola musiman yang kuat</li>
                            <li><strong>Holt-Winters</strong>: Optimal untuk data dengan pola musiman yang jelas (misalnya produksi sawit yang dipengaruhi musim hujan/kemarau)</li>
                            <li><strong>ARIMA</strong>: Cocok untuk data dengan pola kompleks dan autokorelasi tinggi</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Analysis Tab -->
                <div id="analysis" class="card tab-content">
                    <h2 class="card-title">
                        <i class="fas fa-chart-bar"></i> Analisis Akurasi Forecasting
                    </h2>
                    <p>Evaluasi performa berbagai metode forecasting untuk menentukan yang terbaik untuk data produksi Anda.</p>
                    
                    <div id="analysisEmptyState" class="empty-state" style="display: none;">
                        <i class="fas fa-chart-bar"></i>
                        <h3>Data Historis Diperlukan</h3>
                        <p>Untuk analisis akurasi, Anda perlu menambahkan data historis produksi terlebih dahulu di tab "Input Data Produksi".</p>
                        <button id="goToInputData2" class="btn btn-primary">
                            <i class="fas fa-database"></i> Ke Input Data
                        </button>
                    </div>
                    
                    <div id="analysisContent">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px;">
                            <div>
                                <h3 style="color: #2d5016; margin-bottom: 20px;">Perbandingan Akurasi</h3>
                                <div class="chart-container">
                                    <canvas id="accuracyChart"></canvas>
                                </div>
                            </div>
                            
                            <div>
                                <h3 style="color: #2d5016; margin-bottom: 20px;">Metrik Evaluasi</h3>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Metode</th>
                                            <th>MAPE</th>
                                            <th>RMSE</th>
                                            <th>MAE</th>
                                            <th>Akurasi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="accuracyTableBody">
                                        <tr>
                                            <td>Moving Average</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td><span class="accuracy-badge">-</span></td>
                                        </tr>
                                        <tr>
                                            <td>Exponential Smoothing</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td><span class="accuracy-badge">-</span></td>
                                        </tr>
                                        <tr>
                                            <td>Regresi Linear</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td><span class="accuracy-badge">-</span></td>
                                        </tr>
                                        <tr>
                                            <td>Holt-Winters</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td><span class="accuracy-badge">-</span></td>
                                        </tr>
                                        <tr>
                                            <td>ARIMA</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td><span class="accuracy-badge">-</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <div style="margin-top: 25px; padding: 15px; background-color: #e8f5e9; border-radius: 8px;">
                                    <h4 style="color: #2d5016; margin-bottom: 10px;">Kesimpulan Analisis</h4>
                                    <p id="analysisConclusion" style="color: #666; font-size: 0.95rem;">
                                        Tambahkan data historis untuk melihat analisis akurasi metode forecasting.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Reports Tab -->
                <div id="reports" class="card tab-content">
                    <div id="reportsRestricted" class="empty-state" style="display: none;">
                        <i class="fas fa-lock"></i>
                        <h3>Akses Dibatasi</h3>
                        <p>Anda tidak memiliki izin untuk mengakses fitur Laporan. Hanya Admin, Manager, dan Analyst yang dapat mengakses fitur ini.</p>
                        <p>Role Anda saat ini: <strong id="currentRoleDisplayReports">Viewer</strong></p>
                        <button class="btn btn-secondary" id="backToDashboardFromReports">
                            <i class="fas fa-arrow-left"></i> Kembali ke Dashboard
                        </button>
                    </div>
                    
                    <div id="reportsContent">
                        <h2 class="card-title">
                            <i class="fas fa-file-export"></i> Laporan dan Ekspor Data
                        </h2>
                        <p>Hasilkan laporan forecasting dan ekspor data untuk keperluan analisis lebih lanjut atau presentasi.</p>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px;">
                            <div>
                                <h3 style="color: #2d5016; margin-bottom: 20px;">Buat Laporan</h3>
                                <div class="form-group">
                                    <label for="reportType">Jenis Laporan</label>
                                    <select id="reportType">
                                        <option value="forecast-report">Laporan Forecasting Bulanan</option>
                                        <option value="accuracy-report">Laporan Analisis Akurasi</option>
                                        <option value="comparison-report">Laporan Perbandingan Metode</option>
                                        <option value="full-report">Laporan Lengkap</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="reportPeriod">Periode Laporan</label>
                                    <div style="display: flex; gap: 10px;">
                                        <input type="month" id="startPeriod" value="2023-01" style="flex: 1;">
                                        <span>s/d</span>
                                        <input type="month" id="endPeriod" value="2024-12" style="flex: 1;">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="reportFormat">Format Ekspor</label>
                                    <select id="reportFormat">
                                        <option value="pdf">PDF</option>
                                        <option value="excel">Excel</option>
                                        <option value="csv">CSV</option>
                                        <option value="html">HTML</option>
                                    </select>
                                </div>
                                
                                <div class="btn-group">
                                    <button id="generateReport" class="btn btn-primary">
                                        <i class="fas fa-file-pdf"></i> Hasilkan Laporan
                                    </button>
                                    <button id="previewReport" class="btn btn-secondary">
                                        <i class="fas fa-eye"></i> Preview
                                    </button>
                                </div>
                                
                                <div style="margin-top: 30px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
                                    <h4 style="color: #2d5016; margin-bottom: 10px;">Template Laporan Tersedia</h4>
                                    <ul style="color: #666; padding-left: 20px;">
                                        <li>Laporan Bulanan untuk Manajemen</li>
                                        <li>Laporan Tahunan untuk Pemangku Kepentingan</li>
                                        <li>Laporan Teknis untuk Analis Data</li>
                                        <li>Laporan Presentasi untuk Rapat</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div>
                                <h3 style="color: #2d5016; margin-bottom: 20px;">Preview Laporan</h3>
                                <div id="reportPreview" style="background-color: #f8f9fa; border: 1px dashed #ddd; border-radius: 8px; padding: 20px; min-height: 400px;">
                                    <div style="text-align: center; color: #999; margin-top: 150px;">
                                        <i class="fas fa-file-alt" style="font-size: 3rem; margin-bottom: 15px;"></i>
                                        <p>Preview laporan akan ditampilkan di sini setelah dihasilkan</p>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 30px;">
                                    <h4 style="color: #2d5016; margin-bottom: 15px;">Laporan Tersimpan</h4>
                                    <div id="savedReportsEmptyState" class="empty-state" style="padding: 20px;">
                                        <i class="fas fa-file-alt"></i>
                                        <h3>Tidak Ada Laporan</h3>
                                        <p>Belum ada laporan yang tersimpan. Hasilkan laporan terlebih dahulu.</p>
                                    </div>
                                    <table id="savedReportsTable" style="display: none;">
                                        <thead>
                                            <tr>
                                                <th>Nama Laporan</th>
                                                <th>Tanggal</th>
                                                <th>Format</th>
                                                <th>Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody id="savedReportsTableBody">
                                            <!-- Data laporan tersimpan akan diisi oleh JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- User Management Tab (Admin Only) -->
                <div id="user-management" class="card tab-content">
                    <h2 class="card-title">
                        <i class="fas fa-users-cog"></i> Manajemen User
                    </h2>
                    <p>Kelola pengguna sistem forecasting minyak kelapa sawit. Hanya Admin yang dapat mengakses fitur ini.</p>
                    
                    <div class="access-control">
                        <h3 style="color: #2d5016; margin-bottom: 15px;">Daftar Pengguna Sistem</h3>
                        <div class="btn-group">
                            <button id="addUserBtn" class="btn btn-primary">
                                <i class="fas fa-user-plus"></i> Tambah User Baru
                            </button>
                            <button id="refreshUsersBtn" class="btn btn-secondary">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        
                        <div style="margin-top: 20px; overflow-x: auto;">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>Nama Lengkap</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Terakhir Login</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- Data user akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3 style="color: #2d5016; margin-bottom: 15px;">Hak Akses Berdasarkan Role</h3>
                            <ul class="access-list">
                                <li>
                                    <strong>Administrator</strong>
                                    <span>Akses penuh ke semua fitur termasuk manajemen user dan log sistem</span>
                                </li>
                                <li>
                                    <strong>Manager</strong>
                                    <span>Akses ke input data, forecasting, analisis, dan laporan</span>
                                </li>
                                <li>
                                    <strong>Analyst</strong>
                                    <span>Akses ke input data, forecasting, dan analisis</span>
                                </li>
                                <li>
                                    <strong>Viewer</strong>
                                    <span>Hanya dapat melihat dashboard dan hasil forecasting</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- System Logs Tab (Admin Only) -->
                <div id="system-logs" class="card tab-content">
                    <h2 class="card-title">
                        <i class="fas fa-history"></i> Log Sistem
                    </h2>
                    <p>Pantau aktivitas sistem dan pengguna. Hanya Admin yang dapat mengakses fitur ini.</p>
                    
                    <div class="access-control">
                        <h3 style="color: #2d5016; margin-bottom: 15px;">Aktivitas Sistem</h3>
                        <div class="btn-group">
                            <button id="filterLogsToday" class="btn btn-secondary">
                                <i class="fas fa-calendar-day"></i> Hari Ini
                            </button>
                            <button id="filterLogsWeek" class="btn btn-secondary">
                                <i class="fas fa-calendar-week"></i> Minggu Ini
                            </button>
                            <button id="filterLogsMonth" class="btn btn-secondary">
                                <i class="fas fa-calendar-alt"></i> Bulan Ini
                            </button>
                            <button id="clearLogsBtn" class="btn btn-danger">
                                <i class="fas fa-trash"></i> Hapus Log
                            </button>
                        </div>
                        
                        <div style="margin-top: 20px; max-height: 500px; overflow-y: auto;">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Waktu</th>
                                        <th>User</th>
                                        <th>Role</th>
                                        <th>Aktivitas</th>
                                        <th>Detail</th>
                                        <th>IP Address</th>
                                    </tr>
                                </thead>
                                <tbody id="systemLogsTableBody">
                                    <!-- Data log akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="margin-top: 30px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
                            <h4 style="color: #2d5016; margin-bottom: 10px;">Informasi Log</h4>
                            <p style="color: #666; font-size: 0.95rem;">
                                Log sistem mencatat semua aktivitas penting termasuk login, input data, forecasting, dan perubahan konfigurasi.
                                Data log disimpan selama 90 hari sebelum dihapus otomatis.
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Profile Tab -->
                <div id="profile" class="card tab-content">
                    <h2 class="card-title">
                        <i class="fas fa-user"></i> Profil Saya
                    </h2>
                    <p>Kelola informasi profil dan preferensi akun Anda.</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px;">
                        <div>
                            <h3 style="color: #2d5016; margin-bottom: 20px;">Informasi Profil</h3>
                            <form id="profileForm">
                                <div class="form-group">
                                    <label for="profileUsername">Username</label>
                                    <input type="text" id="profileUsername" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label for="profileFullName">Nama Lengkap</label>
                                    <input type="text" id="profileFullName" placeholder="Masukkan nama lengkap">
                                </div>
                                
                                <div class="form-group">
                                    <label for="profileEmail">Email</label>
                                    <input type="email" id="profileEmail" placeholder="Masukkan email">
                                </div>
                                
                                <div class="form-group">
                                    <label for="profileRole">Role</label>
                                    <input type="text" id="profileRole" readonly>
                                </div>
                                
                                <div class="btn-group">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Simpan Perubahan
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <div>
                            <h3 style="color: #2d5016; margin-bottom: 20px;">Keamanan Akun</h3>
                            <form id="passwordForm">
                                <div class="form-group">
                                    <label for="currentPassword">Password Saat Ini</label>
                                    <input type="password" id="currentPassword" placeholder="Masukkan password saat ini">
                                </div>
                                
                                <div class="form-group">
                                    <label for="newPassword">Password Baru</label>
                                    <input type="password" id="newPassword" placeholder="Masukkan password baru">
                                </div>
                                
                                <div class="form-group">
                                    <label for="confirmPassword">Konfirmasi Password Baru</label>
                                    <input type="password" id="confirmPassword" placeholder="Konfirmasi password baru">
                                </div>
                                
                                <div class="btn-group">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-key"></i> Ubah Password
                                    </button>
                                </div>
                            </form>
                            
                            <div style="margin-top: 30px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
                                <h4 style="color: #2d5016; margin-bottom: 10px;">Aktivitas Terakhir</h4>
                                <p style="color: #666; font-size: 0.9rem;" id="lastActivityText">
                                    Loading...
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Tab -->
                <div id="settings" class="card tab-content">
                    <h2 class="card-title">
                        <i class="fas fa-cog"></i> Pengaturan Sistem
                    </h2>
                    <p>Konfigurasi preferensi sistem forecasting.</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px;">
                        <div>
                            <h3 style="color: #2d5016; margin-bottom: 20px;">Pengaturan Forecasting</h3>
                            <form id="settingsForm">
                                <div class="form-group">
                                    <label for="defaultForecastMethod">Metode Forecasting Default</label>
                                    <select id="defaultForecastMethod">
                                        <option value="holt-winters">Holt-Winters</option>
                                        <option value="arima">ARIMA</option>
                                        <option value="exponential-smoothing">Exponential Smoothing</option>
                                        <option value="moving-average">Moving Average</option>
                                        <option value="linear-regression">Regresi Linear</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="defaultForecastPeriod">Periode Forecasting Default (Bulan)</label>
                                    <input type="number" id="defaultForecastPeriod" min="1" max="24" value="12">
                                </div>
                                
                                <div class="form-group">
                                    <label for="confidenceLevel">Tingkat Kepercayaan Default (%)</label>
                                    <input type="number" id="confidenceLevel" min="80" max="99" value="95">
                                </div>
                                
                                <div class="form-group">
                                    <label for="dataRetention">Retensi Data Historis (Bulan)</label>
                                    <input type="number" id="dataRetention" min="6" max="60" value="24">
                                </div>
                                
                                <div class="btn-group">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Simpan Pengaturan
                                    </button>
                                    <button type="button" id="resetSettings" class="btn btn-secondary">
                                        <i class="fas fa-undo"></i> Reset ke Default
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <div>
                            <h3 style="color: #2d5016; margin-bottom: 20px;">Notifikasi</h3>
                            <form id="notificationForm">
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="emailNotifications" checked>
                                        <span>Email Notifikasi</span>
                                    </label>
                                </div>
                                
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="forecastAlerts" checked>
                                        <span>Alert Forecasting</span>
                                    </label>
                                </div>
                                
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="dataChangeAlerts">
                                        <span>Alert Perubahan Data</span>
                                    </label>
                                </div>
                                
                                <div class="form-group">
                                    <label for="reportFrequency">Frekuensi Laporan Otomatis</label>
                                    <select id="reportFrequency">
                                        <option value="none">Tidak Ada</option>
                                        <option value="weekly">Mingguan</option>
                                        <option value="monthly" selected>Bulanan</option>
                                        <option value="quarterly">Kuartalan</option>
                                    </select>
                                </div>
                                
                                <div class="btn-group">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-bell"></i> Simpan Preferensi Notifikasi
                                    </button>
                                </div>
                            </form>
                            
                            <div style="margin-top: 30px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
                                <h4 style="color: #2d5016; margin-bottom: 10px;">Informasi Sistem</h4>
                                <p style="color: #666; font-size: 0.9rem;" id="systemInfoText">
                                    Versi: 2.0.0<br>
                                    Total Data: <span id="totalDataCount">0</span> records<br>
                                    User Aktif: <span id="activeUserCount">1</span> user<br>
                                    Terakhir Update: <span id="lastSystemUpdate">-</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
        
        <!-- Modal Add/Edit User -->
        <div id="userModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="userModalTitle">Tambah User Baru</h3>
                    <span class="close-modal">&times;</span>
                </div>
                <div class="modal-body">
                    <form id="userForm">
                        <input type="hidden" id="editUserId" value="">
                        <div class="form-group">
                            <label for="modalUsername">Username</label>
                            <input type="text" id="modalUsername" placeholder="Masukkan username" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="modalFullName">Nama Lengkap</label>
                            <input type="text" id="modalFullName" placeholder="Masukkan nama lengkap" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="modalEmail">Email</label>
                            <input type="email" id="modalEmail" placeholder="Masukkan email" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="modalRole">Role</label>
                            <select id="modalRole" required>
                                <option value="">Pilih Role</option>
                                <option value="admin">Administrator</option>
                                <option value="manager">Manager</option>
                                <option value="analyst">Analyst</option>
                                <option value="viewer">Viewer</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="modalPassword">Password</label>
                            <input type="password" id="modalPassword" placeholder="Masukkan password">
                            <small style="color: #666;">Kosongkan jika tidak ingin mengubah password</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="modalStatus">Status</label>
                            <select id="modalStatus" required>
                                <option value="active">Aktif</option>
                                <option value="inactive">Nonaktif</option>
                                <option value="suspended">Ditangguhkan</option>
                            </select>
                        </div>
                        
                        <div class="btn-group" style="justify-content: flex-end;">
                            <button type="submit" class="btn btn-primary" id="saveUserBtn">
                                Simpan
                            </button>
                            <button type="button" class="btn btn-secondary" id="cancelUserBtn">
                                Batal
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Modal Preview Laporan -->
        <div id="reportPreviewModal" class="modal">
            <div class="modal-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
                <div class="modal-header">
                    <h3 class="modal-title">Preview Laporan</h3>
                    <span class="close-modal">&times;</span>
                </div>
                <div class="modal-body" id="modalReportPreview">
                    <!-- Konten preview laporan akan dimuat di sini -->
                </div>
                <div class="btn-group" style="margin-top: 20px; justify-content: flex-end;">
                    <button id="downloadReportModal" class="btn btn-primary">
                        <i class="fas fa-download"></i> Download Laporan
                    </button>
                    <button id="closePreview" class="btn btn-secondary">Tutup</button>
                </div>
            </div>
        </div>
        
        <!-- Modal Konfirmasi -->
        <div id="confirmModal" class="modal">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h3 class="modal-title" id="confirmModalTitle">Konfirmasi</h3>
                    <span class="close-modal">&times;</span>
                </div>
                <div class="modal-body">
                    <p id="confirmModalMessage">Apakah Anda yakin?</p>
                    <div class="btn-group" style="justify-content: flex-end;">
                        <button id="confirmModalYes" class="btn btn-primary">Ya</button>
                        <button id="confirmModalNo" class="btn btn-secondary">Tidak</button>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Sistem Forecasting Minyak Kelapa Sawit &copy; 2023 - Digunakan untuk Perencanaan Produksi Perkebunan Kelapa Sawit</p>
            <p style="margin-top: 5px; font-size: 0.85rem;">Versi 2.0.0 | Hak Akses: <span id="footerRole">Admin</span> | <span id="footerStatus">Aktif</span></p>
        </footer>
    </div>

    <script>
        // ============================================
        // DATA DAN KONFIGURASI SISTEM
        // ============================================
        
        // Data pengguna sistem
        const users = [
            { id: 1, username: 'admin', password: 'admin123', fullName: 'Administrator Sistem', email: 'admin@sawit-forecast.com', role: 'admin', status: 'active', lastLogin: '2023-06-15 08:30:00' },
            { id: 2, username: 'manager', password: 'manager123', fullName: 'Manager Produksi', email: 'manager@sawit-forecast.com', role: 'manager', status: 'active', lastLogin: '2023-06-14 14:20:00' },
            { id: 3, username: 'analyst', password: 'analyst123', fullName: 'Analis Data', email: 'analyst@sawit-forecast.com', role: 'analyst', status: 'active', lastLogin: '2023-06-13 10:15:00' },
            { id: 4, username: 'viewer', password: 'viewer123', fullName: 'Viewer Sistem', email: 'viewer@sawit-forecast.com', role: 'viewer', status: 'active', lastLogin: '2023-06-12 16:45:00' }
        ];
        
        // Data kosong untuk aplikasi
        let productionData = {
            labels: [],
            values: []
        };
        
        let historicalData = []; // Data historis kosong
        let savedReports = []; // Data laporan tersimpan
        let systemLogs = []; // Log sistem
        let currentUser = null; // User yang sedang login
        let currentRole = ''; // Role user saat ini
        
        // Hak akses berdasarkan role
        const rolePermissions = {
            admin: {
                dashboard: true,
                dataInput: true,
                forecasting: true,
                methods: true,
                analysis: true,
                reports: true,
                userManagement: true,
                systemLogs: true,
                profile: true,
                settings: true
            },
            manager: {
                dashboard: true,
                dataInput: true,
                forecasting: true,
                methods: true,
                analysis: true,
                reports: true,
                userManagement: false,
                systemLogs: false,
                profile: true,
                settings: true
            },
            analyst: {
                dashboard: true,
                dataInput: true,
                forecasting: true,
                methods: true,
                analysis: true,
                reports: true,
                userManagement: false,
                systemLogs: false,
                profile: true,
                settings: true
            },
            viewer: {
                dashboard: true,
                dataInput: false,
                forecasting: true,
                methods: true,
                analysis: true,
                reports: false,
                userManagement: false,
                systemLogs: false,
                profile: true,
                settings: true
            }
        };
        
        // Role display names
        const roleDisplayNames = {
            admin: 'Administrator',
            manager: 'Manager',
            analyst: 'Analyst',
            viewer: 'Viewer'
        };
        
        // ============================================
        // INISIALISASI APLIKASI
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Setup login form
            setupLogin();
            
            // Setup user dropdown
            setupUserDropdown();
            
            // Setup modals
            setupModals();
            
            // Setup initial system logs
            initializeSystemLogs();
        });
        
        // ============================================
        // FUNGSI LOGIN DAN AUTHENTIKASI
        // ============================================
        
        function setupLogin() {
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const username = document.getElementById('username').value;
                    const password = document.getElementById('password').value;
                    const role = document.getElementById('role').value;
                    
                    // Validasi login
                    const user = users.find(u => 
                        u.username === username && 
                        u.password === password && 
                        u.role === role
                    );
                    
                    if (user) {
                        // Login berhasil
                        currentUser = user;
                        currentRole = role;
                        
                        // Tambah log login
                        addSystemLog('login', `User ${username} berhasil login sebagai ${roleDisplayNames[role]}`, user);
                        
                        // Tampilkan aplikasi utama
                        showMainApp();
                        
                        // Update UI berdasarkan role
                        updateUIForRole();
                        
                        // Setup aplikasi utama
                        setupMainApp();
                    } else {
                        // Login gagal
                        showMessage('Username, password, atau role tidak valid', 'danger');
                    }
                });
            }
        }
        
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Update user info di header
            document.getElementById('currentUserName').textContent = currentUser.fullName;
            document.getElementById('currentUserRole').textContent = roleDisplayNames[currentRole];
            document.getElementById('sidebarRole').textContent = roleDisplayNames[currentRole];
            document.getElementById('footerRole').textContent = roleDisplayNames[currentRole];
        }
        
        function logout() {
            // Tambah log logout
            addSystemLog('logout', `User ${currentUser.username} logout dari sistem`, currentUser);
            
            // Reset state
            currentUser = null;
            currentRole = '';
            
            // Tampilkan login screen
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            
            // Reset form login
            document.getElementById('loginForm').reset();
            
            showMessage('Anda telah logout dari sistem', 'info');
        }
        
        // ============================================
        // FUNGSI MANAJEMEN ROLE DAN AKSES
        // ============================================
        
        function updateUIForRole() {
            const permissions = rolePermissions[currentRole];
            
            // Update menu sidebar
            updateMenuVisibility(permissions);
            
            // Update user dropdown menu
            updateUserDropdownMenu(permissions);
            
            // Update badge pada menu
            updateMenuBadges(permissions);
        }
        
        function updateMenuVisibility(permissions) {
            // Menu Input Data
            const dataInputMenuItem = document.getElementById('dataInputMenuItem');
            if (dataInputMenuItem) {
                if (!permissions.dataInput) {
                    dataInputMenuItem.style.display = 'none';
                } else {
                    dataInputMenuItem.style.display = 'flex';
                }
            }
            
            // Menu Laporan
            const reportsMenuItem = document.getElementById('reportsMenuItem');
            if (reportsMenuItem) {
                if (!permissions.reports) {
                    reportsMenuItem.style.display = 'none';
                } else {
                    reportsMenuItem.style.display = 'flex';
                }
            }
            
            // Menu Manajemen User (sidebar)
            const userManagementSideMenuItem = document.getElementById('userManagementSideMenuItem');
            if (userManagementSideMenuItem) {
                if (!permissions.userManagement) {
                    userManagementSideMenuItem.style.display = 'none';
                } else {
                    userManagementSideMenuItem.style.display = 'flex';
                }
            }
            
            // Menu Log Sistem (sidebar)
            const systemLogsSideMenuItem = document.getElementById('systemLogsSideMenuItem');
            if (systemLogsSideMenuItem) {
                if (!permissions.systemLogs) {
                    systemLogsSideMenuItem.style.display = 'none';
                } else {
                    systemLogsSideMenuItem.style.display = 'flex';
                }
            }
        }
        
        function updateUserDropdownMenu(permissions) {
            // Menu Manajemen User (dropdown)
            const userManagementMenuItem = document.getElementById('userManagementMenuItem');
            if (userManagementMenuItem) {
                if (!permissions.userManagement) {
                    userManagementMenuItem.style.display = 'none';
                } else {
                    userManagementMenuItem.style.display = 'flex';
                }
            }
            
            // Menu Log Sistem (dropdown)
            const systemLogsMenuItem = document.getElementById('systemLogsMenuItem');
            if (systemLogsMenuItem) {
                if (!permissions.systemLogs) {
                    systemLogsMenuItem.style.display = 'none';
                } else {
                    systemLogsMenuItem.style.display = 'flex';
                }
            }
        }
        
        function updateMenuBadges(permissions) {
            const dataInputBadge = document.getElementById('dataInputBadge');
            const reportsBadge = document.getElementById('reportsBadge');
            
            if (dataInputBadge) {
                if (!permissions.dataInput) {
                    dataInputBadge.style.display = 'inline-block';
                } else {
                    dataInputBadge.style.display = 'none';
                }
            }
            
            if (reportsBadge) {
                if (!permissions.reports) {
                    reportsBadge.style.display = 'inline-block';
                } else {
                    reportsBadge.style.display = 'none';
                }
            }
        }
        
        function checkAccess(tabId) {
            const permissions = rolePermissions[currentRole];
            
            switch(tabId) {
                case 'data-input':
                    if (!permissions.dataInput) {
                        showRestrictedAccess('data-input');
                        return false;
                    }
                    break;
                case 'reports':
                    if (!permissions.reports) {
                        showRestrictedAccess('reports');
                        return false;
                    }
                    break;
                case 'user-management':
                    if (!permissions.userManagement) {
                        showMessage('Anda tidak memiliki akses ke Manajemen User', 'warning');
                        return false;
                    }
                    break;
                case 'system-logs':
                    if (!permissions.systemLogs) {
                        showMessage('Anda tidak memiliki akses ke Log Sistem', 'warning');
                        return false;
                    }
                    break;
            }
            
            return true;
        }
        
        function showRestrictedAccess(tabId) {
            if (tabId === 'data-input') {
                document.getElementById('dataInputRestricted').style.display = 'block';
                document.getElementById('dataInputContent').style.display = 'none';
                document.getElementById('currentRoleDisplay').textContent = roleDisplayNames[currentRole];
            } else if (tabId === 'reports') {
                document.getElementById('reportsRestricted').style.display = 'block';
                document.getElementById('reportsContent').style.display = 'none';
                document.getElementById('currentRoleDisplayReports').textContent = roleDisplayNames[currentRole];
            }
        }
        
        function hideRestrictedAccess(tabId) {
            if (tabId === 'data-input') {
                document.getElementById('dataInputRestricted').style.display = 'none';
                document.getElementById('dataInputContent').style.display = 'block';
            } else if (tabId === 'reports') {
                document.getElementById('reportsRestricted').style.display = 'none';
                document.getElementById('reportsContent').style.display = 'block';
            }
        }
        
        // ============================================
        // FUNGSI UTAMA APLIKASI
        // ============================================
        
        function setupMainApp() {
            // Setup tab navigation
            setupTabs();
            
            // Setup chart
            setupCharts();
            
            // Setup form submission
            setupForms();
            
            // Setup event listeners
            setupEventListeners();
            
            // Setup user management jika admin
            if (currentRole === 'admin') {
                setupUserManagement();
                setupSystemLogs();
            }
            
            // Tampilkan empty state untuk tabel data
            showEmptyTableState();
            
            // Update statistik dashboard
            updateDashboardStats();
            
            // Update informasi profil
            updateProfileInfo();
            
            // Update pengaturan
            updateSettings();
        }
        
        function setupTabs() {
            // Tab navigation
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Tutup user dropdown jika terbuka
                    document.getElementById('userDropdown').classList.remove('active');
                    
                    const tabId = this.getAttribute('data-tab');
                    
                    // Cek akses
                    if (!checkAccess(tabId)) {
                        return;
                    }
                    
                    // Update active nav link
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show selected tab
                    const tabContents = document.querySelectorAll('.tab-content');
                    tabContents.forEach(tab => tab.classList.remove('active'));
                    document.getElementById(tabId).classList.add('active');
                    
                    // Sembunyikan restricted access jika ada
                    hideRestrictedAccess(tabId);
                    
                    // Update charts jika needed
                    if (tabId === 'dashboard') {
                        updateForecastChart('overview');
                    }
                    
                    // Tampilkan/sembunyikan empty state berdasarkan tab
                    if (tabId === 'forecasting') {
                        if (historicalData.length === 0) {
                            document.getElementById('forecastingEmptyState').style.display = 'block';
                            document.getElementById('forecastingContent').style.display = 'none';
                        } else {
                            document.getElementById('forecastingEmptyState').style.display = 'none';
                            document.getElementById('forecastingContent').style.display = 'block';
                        }
                    }
                    
                    if (tabId === 'analysis') {
                        if (historicalData.length === 0) {
                            document.getElementById('analysisEmptyState').style.display = 'block';
                            document.getElementById('analysisContent').style.display = 'none';
                        } else {
                            document.getElementById('analysisEmptyState').style.display = 'none';
                            document.getElementById('analysisContent').style.display = 'block';
                        }
                    }
                    
                    // Load data untuk tab khusus admin
                    if (tabId === 'user-management' && currentRole === 'admin') {
                        loadUsersTable();
                    }
                    
                    if (tabId === 'system-logs' && currentRole === 'admin') {
                        loadSystemLogs();
                    }
                });
            });
            
            // User dropdown menu items
            const userDropdownItems = document.querySelectorAll('.user-dropdown-item[data-tab]');
            userDropdownItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.getAttribute('data-tab');
                    
                    // Tutup dropdown
                    document.getElementById('userDropdown').classList.remove('active');
                    
                    // Cari dan klik menu sidebar yang sesuai
                    const sidebarLink = document.querySelector(`.nav-link[data-tab="${tabId}"]`);
                    if (sidebarLink) {
                        sidebarLink.click();
                    }
                });
            });
            
            // Chart tabs in dashboard
            const chartTabs = document.querySelectorAll('.tab[data-chart]');
            chartTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const chartType = this.getAttribute('data-chart');
                    
                    // Update active tab
                    chartTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update chart
                    updateForecastChart(chartType);
                });
            });
        }
        
        function setupUserDropdown() {
            const userDropdownToggle = document.getElementById('userDropdownToggle');
            const userDropdown = document.getElementById('userDropdown');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (userDropdownToggle) {
                userDropdownToggle.addEventListener('click', function() {
                    userDropdown.classList.toggle('active');
                });
            }
            
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    logout();
                });
            }
            
            // Tutup dropdown ketika klik di luar
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.user-info')) {
                    userDropdown.classList.remove('active');
                }
            });
        }
        
        // ============================================
        // FUNGSI MANAJEMEN USER (ADMIN ONLY)
        // ============================================
        
        function setupUserManagement() {
            // Load users table
            loadUsersTable();
            
            // Setup event listeners untuk user management
            document.getElementById('addUserBtn')?.addEventListener('click', function() {
                openUserModal();
            });
            
            document.getElementById('refreshUsersBtn')?.addEventListener('click', function() {
                loadUsersTable();
                showMessage('Daftar user diperbarui', 'info');
            });
        }
        
        function loadUsersTable() {
            const usersTableBody = document.getElementById('usersTableBody');
            if (!usersTableBody) return;
            
            usersTableBody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.fullName}</td>
                    <td>${user.email}</td>
                    <td><span class="role-badge role-${user.role}">${roleDisplayNames[user.role]}</span></td>
                    <td>
                        <span style="color: ${user.status === 'active' ? '#4caf50' : user.status === 'inactive' ? '#9e9e9e' : '#f44336'};">
                            ${user.status === 'active' ? 'Aktif' : user.status === 'inactive' ? 'Nonaktif' : 'Ditangguhkan'}
                        </span>
                    </td>
                    <td>${user.lastLogin || '-'}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-info edit-user-btn" data-id="${user.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            ${user.username !== currentUser.username ? `
                                <button class="btn btn-danger delete-user-btn" data-id="${user.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                    </td>
                `;
                usersTableBody.appendChild(row);
            });
            
            // Add event listeners untuk tombol edit dan delete
            document.querySelectorAll('.edit-user-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const userId = parseInt(this.getAttribute('data-id'));
                    editUser(userId);
                });
            });
            
            document.querySelectorAll('.delete-user-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const userId = parseInt(this.getAttribute('data-id'));
                    deleteUser(userId);
                });
            });
        }
        
        function openUserModal(userId = null) {
            const modal = document.getElementById('userModal');
            const title = document.getElementById('userModalTitle');
            const form = document.getElementById('userForm');
            
            if (userId) {
                // Edit mode
                title.textContent = 'Edit User';
                const user = users.find(u => u.id === userId);
                if (user) {
                    document.getElementById('editUserId').value = user.id;
                    document.getElementById('modalUsername').value = user.username;
                    document.getElementById('modalFullName').value = user.fullName;
                    document.getElementById('modalEmail').value = user.email;
                    document.getElementById('modalRole').value = user.role;
                    document.getElementById('modalStatus').value = user.status;
                    document.getElementById('modalPassword').value = '';
                    document.getElementById('modalUsername').readOnly = true;
                }
            } else {
                // Add mode
                title.textContent = 'Tambah User Baru';
                form.reset();
                document.getElementById('editUserId').value = '';
                document.getElementById('modalUsername').readOnly = false;
            }
            
            modal.style.display = 'flex';
        }
        
        function editUser(userId) {
            openUserModal(userId);
        }
        
        function deleteUser(userId) {
            if (userId === currentUser.id) {
                showMessage('Anda tidak dapat menghapus akun sendiri', 'warning');
                return;
            }
            
            showConfirmModal(
                'Hapus User',
                'Apakah Anda yakin ingin menghapus user ini?',
                function() {
                    const index = users.findIndex(u => u.id === userId);
                    if (index !== -1) {
                        const deletedUser = users[index];
                        users.splice(index, 1);
                        
                        // Tambah log sistem
                        addSystemLog('user_delete', `User ${deletedUser.username} dihapus oleh ${currentUser.username}`, currentUser);
                        
                        // Reload table
                        loadUsersTable();
                        
                        showMessage('User berhasil dihapus', 'success');
                    }
                }
            );
        }
        
        // ============================================
        // FUNGSI LOG SISTEM (ADMIN ONLY)
        // ============================================
        
        function initializeSystemLogs() {
            // Log inisialisasi sistem
            const initLog = {
                id: 1,
                timestamp: new Date().toISOString(),
                user: 'system',
                role: 'system',
                activity: 'system_init',
                details: 'Sistem forecasting diinisialisasi',
                ipAddress: '127.0.0.1'
            };
            
            systemLogs.push(initLog);
        }
        
        function addSystemLog(activity, details, user = null) {
            const logId = systemLogs.length > 0 ? Math.max(...systemLogs.map(l => l.id)) + 1 : 1;
            
            const log = {
                id: logId,
                timestamp: new Date().toISOString(),
                user: user ? user.username : 'system',
                role: user ? user.role : 'system',
                activity: activity,
                details: details,
                ipAddress: '192.168.1.' + Math.floor(Math.random() * 255) // Simulasi IP
            };
            
            systemLogs.unshift(log);
            
            // Update log display jika tab log sedang aktif
            if (document.getElementById('system-logs')?.classList.contains('active')) {
                loadSystemLogs();
            }
        }
        
        function setupSystemLogs() {
            // Setup event listeners untuk log sistem
            document.getElementById('filterLogsToday')?.addEventListener('click', function() {
                filterLogs('today');
            });
            
            document.getElementById('filterLogsWeek')?.addEventListener('click', function() {
                filterLogs('week');
            });
            
            document.getElementById('filterLogsMonth')?.addEventListener('click', function() {
                filterLogs('month');
            });
            
            document.getElementById('clearLogsBtn')?.addEventListener('click', function() {
                showConfirmModal(
                    'Hapus Log Sistem',
                    'Apakah Anda yakin ingin menghapus semua log sistem? Tindakan ini tidak dapat dibatalkan.',
                    function() {
                        systemLogs = [];
                        initializeSystemLogs();
                        loadSystemLogs();
                        showMessage('Log sistem berhasil dihapus', 'success');
                    }
                );
            });
        }
        
        function loadSystemLogs() {
            const logsTableBody = document.getElementById('systemLogsTableBody');
            if (!logsTableBody) return;
            
            logsTableBody.innerHTML = '';
            
            // Tampilkan 50 log terbaru
            const logsToShow = systemLogs.slice(0, 50);
            
            logsToShow.forEach(log => {
                const row = document.createElement('tr');
                
                // Format waktu
                const date = new Date(log.timestamp);
                const timeString = date.toLocaleDateString('id-ID') + ' ' + date.toLocaleTimeString('id-ID');
                
                // Format aktivitas
                let activityText = '';
                switch(log.activity) {
                    case 'login': activityText = 'Login'; break;
                    case 'logout': activityText = 'Logout'; break;
                    case 'data_add': activityText = 'Tambah Data'; break;
                    case 'data_edit': activityText = 'Edit Data'; break;
                    case 'data_delete': activityText = 'Hapus Data'; break;
                    case 'forecast_run': activityText = 'Jalankan Forecasting'; break;
                    case 'report_generate': activityText = 'Buat Laporan'; break;
                    case 'user_add': activityText = 'Tambah User'; break;
                    case 'user_edit': activityText = 'Edit User'; break;
                    case 'user_delete': activityText = 'Hapus User'; break;
                    case 'system_init': activityText = 'Inisialisasi Sistem'; break;
                    default: activityText = log.activity;
                }
                
                row.innerHTML = `
                    <td>${timeString}</td>
                    <td>${log.user}</td>
                    <td><span class="role-badge role-${log.role}">${roleDisplayNames[log.role] || log.role}</span></td>
                    <td>${activityText}</td>
                    <td>${log.details}</td>
                    <td>${log.ipAddress}</td>
                `;
                logsTableBody.appendChild(row);
            });
        }
        
        function filterLogs(filter) {
            const now = new Date();
            let filteredLogs = [];
            
            switch(filter) {
                case 'today':
                    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    filteredLogs = systemLogs.filter(log => new Date(log.timestamp) >= today);
                    break;
                case 'week':
                    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    filteredLogs = systemLogs.filter(log => new Date(log.timestamp) >= weekAgo);
                    break;
                case 'month':
                    const monthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
                    filteredLogs = systemLogs.filter(log => new Date(log.timestamp) >= monthAgo);
                    break;
                default:
                    filteredLogs = systemLogs;
            }
            
            // Update tabel dengan log yang difilter
            const logsTableBody = document.getElementById('systemLogsTableBody');
            if (!logsTableBody) return;
            
            logsTableBody.innerHTML = '';
            
            filteredLogs.forEach(log => {
                const row = document.createElement('tr');
                
                // Format waktu
                const date = new Date(log.timestamp);
                const timeString = date.toLocaleDateString('id-ID') + ' ' + date.toLocaleTimeString('id-ID');
                
                // Format aktivitas
                let activityText = '';
                switch(log.activity) {
                    case 'login': activityText = 'Login'; break;
                    case 'logout': activityText = 'Logout'; break;
                    case 'data_add': activityText = 'Tambah Data'; break;
                    case 'data_edit': activityText = 'Edit Data'; break;
                    case 'data_delete': activityText = 'Hapus Data'; break;
                    case 'forecast_run': activityText = 'Jalankan Forecasting'; break;
                    case 'report_generate': activityText = 'Buat Laporan'; break;
                    case 'user_add': activityText = 'Tambah User'; break;
                    case 'user_edit': activityText = 'Edit User'; break;
                    case 'user_delete': activityText = 'Hapus User'; break;
                    case 'system_init': activityText = 'Inisialisasi Sistem'; break;
                    default: activityText = log.activity;
                }
                
                row.innerHTML = `
                    <td>${timeString}</td>
                    <td>${log.user}</td>
                    <td><span class="role-badge role-${log.role}">${roleDisplayNames[log.role] || log.role}</span></td>
                    <td>${activityText}</td>
                    <td>${log.details}</td>
                    <td>${log.ipAddress}</td>
                `;
                logsTableBody.appendChild(row);
            });
            
            showMessage(`Menampilkan log ${filter === 'today' ? 'hari ini' : filter === 'week' ? 'minggu ini' : 'bulan ini'}`, 'info');
        }
        
        // ============================================
        // FUNGSI CHART DAN VISUALISASI
        // ============================================
        
        let forecastChart, forecastResultChart, accuracyChart;
        
        function setupCharts() {
            const ctx1 = document.getElementById('forecastChart').getContext('2d');
            forecastChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Data Historis',
                            data: [],
                            borderColor: '#4a7c3a',
                            backgroundColor: 'rgba(74, 124, 58, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        y: {
                            beginAtZero: false,
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            title: {
                                display: true,
                                text: 'Produksi (Ton)'
                            }
                        }
                    }
                }
            });
            
            const ctx2 = document.getElementById('forecastResultChart').getContext('2d');
            forecastResultChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Data Historis',
                            data: [],
                            borderColor: '#4a7c3a',
                            backgroundColor: 'rgba(74, 124, 58, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        y: {
                            beginAtZero: false,
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            title: {
                                display: true,
                                text: 'Produksi (Ton)'
                            }
                        }
                    }
                }
            });
            
            const ctx3 = document.getElementById('accuracyChart').getContext('2d');
            accuracyChart = new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: ['Moving Average', 'Exponential Smoothing', 'Regresi Linear', 'Holt-Winters', 'ARIMA'],
                    datasets: [
                        {
                            label: 'Akurasi (%)',
                            data: [],
                            backgroundColor: [
                                '#4a7c3a',
                                '#7cb342',
                                '#9ccc65',
                                '#c5e1a5',
                                '#e8f5e9'
                            ],
                            borderColor: [
                                '#2d5016',
                                '#558b2f',
                                '#689f38',
                                '#9ccc65',
                                '#c5e1a5'
                            ],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 0,
                            max: 100,
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            title: {
                                display: true,
                                text: 'Akurasi (%)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Update chart dengan data kosong
            accuracyChart.update();
        }
        
        // ============================================
        // FUNGSI LAINNYA (SAMA DENGAN SEBELUMNYA)
        // ============================================
        
        // Semua fungsi lainnya (setupForms, setupEventListeners, setupModals, dll.)
        // tetap sama seperti sebelumnya, hanya ditambahkan log sistem di beberapa tempat
        
        function setupForms() {
            // Form input data
            const dataForm = document.getElementById('dataForm');
            if (dataForm) {
                dataForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const editIndex = document.getElementById('editIndex').value;
                    const period = document.getElementById('period').value;
                    const production = parseFloat(document.getElementById('production').value);
                    const rainfall = document.getElementById('rainfall').value ? parseFloat(document.getElementById('rainfall').value) : null;
                    const temperature = document.getElementById('temperature').value ? parseFloat(document.getElementById('temperature').value) : null;
                    
                    if (editIndex === "-1") {
                        // Tambah data baru
                        const newId = historicalData.length > 0 ? Math.max(...historicalData.map(d => d.id)) + 1 : 1;
                        const newData = {
                            id: newId,
                            period: period,
                            periodFormatted: formatMonth(period),
                            production: production,
                            rainfall: rainfall,
                            temperature: temperature
                        };
                        
                        historicalData.unshift(newData);
                        addDataToTable(newData, true);
                        
                        // Update data produksi untuk chart
                        updateProductionData(newData);
                        
                        // Update dashboard
                        updateDashboardStats();
                        
                        // Tambah log sistem
                        addSystemLog('data_add', `Data produksi ${newData.periodFormatted} ditambahkan: ${newData.production} ton`, currentUser);
                        
                        // Aktifkan fitur forecasting dan analisis
                        if (historicalData.length === 1) {
                            document.getElementById('exportData').disabled = false;
                            
                            // Update chart dengan data baru
                            updateForecastChart('overview');
                            
                            // Update empty states di tab lain
                            if (document.querySelector('#forecasting').classList.contains('active')) {
                                document.getElementById('forecastingEmptyState').style.display = 'none';
                                document.getElementById('forecastingContent').style.display = 'block';
                            }
                            
                            if (document.querySelector('#analysis').classList.contains('active')) {
                                document.getElementById('analysisEmptyState').style.display = 'none';
                                document.getElementById('analysisContent').style.display = 'block';
                            }
                        }
                        
                        showMessage('Data berhasil disimpan!', 'success');
                    } else {
                        // Edit data yang ada
                        const index = parseInt(editIndex);
                        if (index >= 0 && index < historicalData.length) {
                            const oldData = historicalData[index];
                            
                            // Hapus data lama dari productionData
                            const oldPeriodFormatted = oldData.periodFormatted;
                            const oldIndex = productionData.labels.indexOf(oldPeriodFormatted);
                            if (oldIndex !== -1) {
                                productionData.labels.splice(oldIndex, 1);
                                productionData.values.splice(oldIndex, 1);
                            }
                            
                            // Update data
                            historicalData[index] = {
                                id: historicalData[index].id,
                                period: period,
                                periodFormatted: formatMonth(period),
                                production: production,
                                rainfall: rainfall,
                                temperature: temperature
                            };
                            
                            // Update tabel
                            populateDataTable();
                            
                            // Update data produksi untuk chart
                            updateProductionData(historicalData[index]);
                            
                            // Update dashboard
                            updateDashboardStats();
                            
                            // Tambah log sistem
                            addSystemLog('data_edit', `Data produksi ${oldData.periodFormatted} diubah: ${oldData.production} ton â ${production} ton`, currentUser);
                            
                            showMessage('Data berhasil diperbarui!', 'success');
                        }
                        
                        // Reset mode edit
                        cancelEditMode();
                    }
                    
                    // Reset form
                    dataForm.reset();
                    document.getElementById('period').value = '2023-07';
                    
                    // Update chart jika sedang melihat dashboard
                    if (document.querySelector('#dashboard').classList.contains('active')) {
                        updateForecastChart('overview');
                    }
                });
            }
            
            // Form user management
            const userForm = document.getElementById('userForm');
            if (userForm) {
                userForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const userId = document.getElementById('editUserId').value;
                    const username = document.getElementById('modalUsername').value;
                    const fullName = document.getElementById('modalFullName').value;
                    const email = document.getElementById('modalEmail').value;
                    const role = document.getElementById('modalRole').value;
                    const password = document.getElementById('modalPassword').value;
                    const status = document.getElementById('modalStatus').value;
                    
                    if (userId) {
                        // Edit user
                        const index = users.findIndex(u => u.id === parseInt(userId));
                        if (index !== -1) {
                            const oldUser = users[index];
                            
                            users[index] = {
                                ...users[index],
                                fullName: fullName,
                                email: email,
                                role: role,
                                status: status
                            };
                            
                            if (password) {
                                users[index].password = password;
                            }
                            
                            // Tambah log sistem
                            addSystemLog('user_edit', `User ${username} diedit oleh ${currentUser.username}`, currentUser);
                            
                            showMessage('User berhasil diperbarui', 'success');
                        }
                    } else {
                        // Tambah user baru
                        const newId = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1;
                        const newUser = {
                            id: newId,
                            username: username,
                            password: password || 'password123', // Default password
                            fullName: fullName,
                            email: email,
                            role: role,
                            status: status,
                            lastLogin: null
                        };
                        
                        users.push(newUser);
                        
                        // Tambah log sistem
                        addSystemLog('user_add', `User ${username} ditambahkan oleh ${currentUser.username}`, currentUser);
                        
                        showMessage('User baru berhasil ditambahkan', 'success');
                    }
                    
                    // Tutup modal dan reload table
                    document.getElementById('userModal').style.display = 'none';
                    loadUsersTable();
                });
            }
            
            // Form profil
            const profileForm = document.getElementById('profileForm');
            if (profileForm) {
                profileForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Simpan perubahan profil
                    showMessage('Profil berhasil diperbarui', 'success');
                });
            }
            
            // Form password
            const passwordForm = document.getElementById('passwordForm');
            if (passwordForm) {
                passwordForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const currentPassword = document.getElementById('currentPassword').value;
                    const newPassword = document.getElementById('newPassword').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    if (currentPassword !== currentUser.password) {
                        showMessage('Password saat ini salah', 'danger');
                        return;
                    }
                    
                    if (newPassword !== confirmPassword) {
                        showMessage('Password baru tidak cocok', 'danger');
                        return;
                    }
                    
                    // Update password
                    currentUser.password = newPassword;
                    
                    // Update di users array
                    const userIndex = users.findIndex(u => u.id === currentUser.id);
                    if (userIndex !== -1) {
                        users[userIndex].password = newPassword;
                    }
                    
                    showMessage('Password berhasil diubah', 'success');
                    passwordForm.reset();
                });
            }
            
            // Form settings
            const settingsForm = document.getElementById('settingsForm');
            if (settingsForm) {
                settingsForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Simpan pengaturan
                    showMessage('Pengaturan berhasil disimpan', 'success');
                });
            }
            
            // Form notification
            const notificationForm = document.getElementById('notificationForm');
            if (notificationForm) {
                notificationForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Simpan preferensi notifikasi
                    showMessage('Preferensi notifikasi berhasil disimpan', 'success');
                });
            }
            
            // Cancel edit button
            const cancelEditBtn = document.getElementById('cancelEdit');
            if (cancelEditBtn) {
                cancelEditBtn.addEventListener('click', function() {
                    cancelEditMode();
                    showMessage('Edit dibatalkan', 'info');
                });
            }
            
            // Reset form
            const resetFormBtn = document.getElementById('resetForm');
            if (resetFormBtn) {
                resetFormBtn.addEventListener('click', function() {
                    document.getElementById('dataForm').reset();
                    document.getElementById('period').value = '2023-07';
                    cancelEditMode();
                });
            }
            
            // Method info
            const methodSelect = document.getElementById('method');
            if (methodSelect) {
                methodSelect.addEventListener('change', function() {
                    const method = this.value;
                    document.getElementById('methodInfo').textContent = getMethodInfo(method);
                });
            }
            
            // Run forecast
            const runForecastBtn = document.getElementById('runForecast');
            if (runForecastBtn) {
                runForecastBtn.addEventListener('click', function() {
                    if (historicalData.length === 0) {
                        showMessage('Tambahkan data historis terlebih dahulu di tab "Input Data Produksi"', 'warning');
                        return;
                    }
                    
                    showMessage('Forecasting sedang dijalankan...', 'info');
                    
                    // Simulasi proses forecasting
                    setTimeout(() => {
                        showMessage('Forecasting berhasil dijalankan!', 'success');
                        
                        // Tambah log sistem
                        addSystemLog('forecast_run', `Forecasting dijalankan dengan metode ${document.getElementById('method').value}`, currentUser);
                        
                        // Update chart dengan data baru
                        const periods = parseInt(document.getElementById('periods').value) || 12;
                        const method = document.getElementById('method').value;
                        
                        // Generate forecast data berdasarkan metode
                        let newForecastData = [];
                        const lastValue = productionData.values.length > 0 ? productionData.values[productionData.values.length - 1] : 2500;
                        
                        if (method === 'moving-average') {
                            // Moving average simulation
                            for (let i = 0; i < periods; i++) {
                                newForecastData.push(lastValue * (1 + (i+1)*0.02));
                            }
                        } else if (method === 'exponential-smoothing') {
                            // Exponential smoothing simulation
                            for (let i = 0; i < periods; i++) {
                                newForecastData.push(lastValue * (1 + (i+1)*0.018));
                            }
                        } else if (method === 'linear-regression') {
                            // Linear regression simulation
                            for (let i = 0; i < periods; i++) {
                                newForecastData.push(lastValue * (1 + (i+1)*0.015));
                            }
                        } else if (method === 'holt-winters') {
                            // Holt-Winters simulation (with seasonality)
                            for (let i = 0; i < periods; i++) {
                                const seasonalFactor = [1.02, 1.05, 1.03, 1.06, 1.04, 1.07, 1.03, 1.05, 1.02, 1.06, 1.08, 1.05];
                                newForecastData.push(lastValue * seasonalFactor[i % 12]);
                            }
                        } else {
                            // ARIMA or default
                            for (let i = 0; i < periods; i++) {
                                newForecastData.push(lastValue * (1 + (i+1)*0.019));
                            }
                        }
                        
                        // Update forecast chart
                        updateForecastResultChart(newForecastData, periods);
                        
                        // Update analisis akurasi
                        updateAccuracyAnalysis();
                    }, 1500);
                });
            }
            
            // Generate report
            const generateReportBtn = document.getElementById('generateReport');
            if (generateReportBtn) {
                generateReportBtn.addEventListener('click', function() {
                    if (historicalData.length === 0) {
                        showMessage('Tambahkan data historis terlebih dahulu untuk membuat laporan', 'warning');
                        return;
                    }
                    
                    const reportType = document.getElementById('reportType').value;
                    const startPeriod = document.getElementById('startPeriod').value;
                    const endPeriod = document.getElementById('endPeriod').value;
                    const reportFormat = document.getElementById('reportFormat').value;
                    
                    showMessage(`Laporan ${reportType} dalam format ${reportFormat} sedang dihasilkan...`, 'info');
                    
                    // Simulasi generate report
                    setTimeout(() => {
                        showMessage(`Laporan berhasil dihasilkan dan siap diunduh!`, 'success');
                        
                        // Tambah log sistem
                        addSystemLog('report_generate', `Laporan ${reportType} dihasilkan dalam format ${reportFormat}`, currentUser);
                        
                        // Buat laporan baru
                        const newReportId = savedReports.length > 0 ? Math.max(...savedReports.map(r => r.id)) + 1 : 1;
                        const reportName = `Laporan_${getReportTypeName(reportType)}_${new Date().toISOString().slice(0, 10)}`;
                        
                        const newReport = {
                            id: newReportId,
                            name: reportName,
                            date: new Date().toLocaleDateString('id-ID'),
                            format: reportFormat.toUpperCase(),
                            type: reportType
                        };
                        
                        savedReports.unshift(newReport);
                        populateSavedReportsTable();
                        
                        // Update preview
                        updateReportPreview(newReport);
                    }, 2000);
                });
            }
            
            // Preview report
            const previewReportBtn = document.getElementById('previewReport');
            if (previewReportBtn) {
                previewReportBtn.addEventListener('click', function() {
                    if (historicalData.length === 0) {
                        showMessage('Tambahkan data historis terlebih dahulu untuk melihat preview laporan', 'warning');
                        return;
                    }
                    
                    const reportType = document.getElementById('reportType').value;
                    const startPeriod = document.getElementById('startPeriod').value;
                    const endPeriod = document.getElementById('endPeriod').value;
                    
                    showMessage('Membuat preview laporan...', 'info');
                    
                    // Simulasi preview
                    setTimeout(() => {
                        const previewReport = {
                            name: `Preview_${getReportTypeName(reportType)}`,
                            date: new Date().toLocaleDateString('id-ID'),
                            format: 'PDF',
                            type: reportType
                        };
                        
                        updateReportPreview(previewReport);
                    }, 1000);
                });
            }
        }
        
        function setupEventListeners() {
            // Add sample data button
            const addSampleDataBtn = document.getElementById('addSampleData');
            if (addSampleDataBtn) {
                addSampleDataBtn.addEventListener('click', function() {
                    // Tambah data contoh
                    const sampleData = [
                        { period: '2023-06', production: 2780, rainfall: 120, temperature: 27.8 },
                        { period: '2023-05', production: 2820, rainfall: 95, temperature: 28.2 },
                        { period: '2023-04', production: 2750, rainfall: 150, temperature: 27.5 },
                        { period: '2023-03', production: 2680, rainfall: 180, temperature: 27.2 },
                        { period: '2023-02', production: 2720, rainfall: 130, temperature: 27.9 },
                        { period: '2023-01', production: 2650, rainfall: 200, temperature: 27.0 }
                    ];
                    
                    sampleData.forEach((data, index) => {
                        setTimeout(() => {
                            const newId = historicalData.length > 0 ? Math.max(...historicalData.map(d => d.id)) + 1 : 1;
                            const newData = {
                                id: newId,
                                period: data.period,
                                periodFormatted: formatMonth(data.period),
                                production: data.production,
                                rainfall: data.rainfall,
                                temperature: data.temperature
                            };
                            
                            historicalData.unshift(newData);
                            addDataToTable(newData, true);
                            updateProductionData(newData);
                            
                            if (index === sampleData.length - 1) {
                                updateDashboardStats();
                                document.getElementById('exportData').disabled = false;
                                
                                // Tambah log sistem
                                addSystemLog('data_add', `Data contoh ditambahkan (${sampleData.length} records)`, currentUser);
                                
                                // Update chart jika sedang melihat dashboard
                                if (document.querySelector('#dashboard').classList.contains('active')) {
                                    updateForecastChart('overview');
                                }
                                
                                showMessage('Data contoh berhasil ditambahkan!', 'success');
                            }
                        }, index * 200);
                    });
                });
            }
            
            // Go to input data buttons
            const goToInputDataBtns = document.querySelectorAll('#goToInputData, #goToInputData2');
            goToInputDataBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Switch to input data tab jika memiliki akses
                    if (rolePermissions[currentRole].dataInput) {
                        document.querySelector('.nav-link[data-tab="data-input"]').click();
                    } else {
                        showMessage('Anda tidak memiliki akses ke Input Data Produksi', 'warning');
                    }
                });
            });
            
            // Back to dashboard buttons
            const backToDashboardBtns = document.querySelectorAll('#backToDashboardFromInput, #backToDashboardFromReports');
            backToDashboardBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelector('.nav-link[data-tab="dashboard"]').click();
                });
            });
            
            // Import data button
            const importDataBtn = document.getElementById('importData');
            if (importDataBtn) {
                importDataBtn.addEventListener('click', function() {
                    // Simulasi import file
                    const fileInput = document.createElement('input');
                    fileInput.type = 'file';
                    fileInput.accept = '.csv,.xlsx,.xls';
                    
                    fileInput.addEventListener('change', function() {
                        if (this.files.length > 0) {
                            showMessage(`Mengimpor file ${this.files[0].name}...`, 'info');
                            
                            setTimeout(() => {
                                showMessage('Data berhasil diimpor!', 'success');
                                
                                // Tambah data contoh setelah import
                                const importedData = [
                                    { period: '2022-12', production: 2580, rainfall: 250, temperature: 26.8 },
                                    { period: '2022-11', production: 2620, rainfall: 180, temperature: 27.3 },
                                    { period: '2022-10', production: 2550, rainfall: 160, temperature: 27.4 },
                                    { period: '2022-09', production: 2480, rainfall: 140, temperature: 27.6 }
                                ];
                                
                                importedData.forEach(data => {
                                    const newId = historicalData.length > 0 ? Math.max(...historicalData.map(d => d.id)) + 1 : 1;
                                    const formattedData = {
                                        id: newId,
                                        period: data.period,
                                        periodFormatted: formatMonth(data.period),
                                        production: data.production,
                                        rainfall: data.rainfall,
                                        temperature: data.temperature
                                    };
                                    
                                    historicalData.unshift(formattedData);
                                    addDataToTable(formattedData, true);
                                    updateProductionData(formattedData);
                                });
                                
                                updateDashboardStats();
                                document.getElementById('exportData').disabled = false;
                                
                                // Tambah log sistem
                                addSystemLog('data_add', `Data diimpor dari file (${importedData.length} records)`, currentUser);
                                
                                // Update chart jika sedang melihat dashboard
                                if (document.querySelector('#dashboard').classList.contains('active')) {
                                    updateForecastChart('overview');
                                }
                            }, 2000);
                        }
                    });
                    
                    fileInput.click();
                });
            }
            
            // Export data button
            const exportDataBtn = document.getElementById('exportData');
            if (exportDataBtn) {
                exportDataBtn.addEventListener('click', function() {
                    if (historicalData.length === 0) {
                        showMessage('Tidak ada data untuk diekspor', 'warning');
                        return;
                    }
                    
                    showMessage('Mengekspor data produksi...', 'info');
                    
                    setTimeout(() => {
                        showMessage('Data berhasil diekspor!', 'success');
                        
                        // Simulasi export data
                        const csvContent = "Periode,Produksi (Ton),Curah Hujan (mm),Suhu (Â°C)\n" +
                            historicalData.map(data => 
                                `${data.periodFormatted},${data.production},${data.rainfall || ''},${data.temperature || ''}`
                            ).join("\n");
                        
                        const blob = new Blob([csvContent], { type: 'text/csv' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `data_produksi_sawit_${new Date().toISOString().slice(0,10)}.csv`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    }, 1500);
                });
            }
            
            // Save forecast button
            const saveForecastBtn = document.getElementById('saveForecast');
            if (saveForecastBtn) {
                saveForecastBtn.addEventListener('click', function() {
                    if (historicalData.length === 0) {
                        showMessage('Tambahkan data historis terlebih dahulu', 'warning');
                        return;
                    }
                    
                    showMessage('Menyimpan hasil forecasting...', 'info');
                    
                    setTimeout(() => {
                        showMessage('Hasil forecasting berhasil disimpan!', 'success');
                    }, 1500);
                });
            }
            
            // Method selection buttons
            const methodButtons = document.querySelectorAll('.select-method-btn');
            methodButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const method = this.getAttribute('data-method');
                    
                    // Update metode di tab forecasting
                    const methodSelect = document.getElementById('method');
                    const options = Array.from(methodSelect.options);
                    const optionIndex = options.findIndex(option => option.value === method);
                    
                    if (optionIndex !== -1) {
                        methodSelect.selectedIndex = optionIndex;
                        document.getElementById('methodInfo').textContent = getMethodInfo(method);
                        
                        // Switch to forecasting tab
                        document.querySelector('.nav-link[data-tab="forecasting"]').click();
                        
                        showMessage(`Metode ${method} telah dipilih!`, 'success');
                    }
                });
            });
            
            // Reset settings button
            const resetSettingsBtn = document.getElementById('resetSettings');
            if (resetSettingsBtn) {
                resetSettingsBtn.addEventListener('click', function() {
                    showConfirmModal(
                        'Reset Pengaturan',
                        'Apakah Anda yakin ingin mengembalikan semua pengaturan ke nilai default?',
                        function() {
                            updateSettings(true);
                            showMessage('Pengaturan berhasil direset ke default', 'success');
                        }
                    );
                });
            }
        }
        
        function setupModals() {
            // Modal user
            const userModal = document.getElementById('userModal');
            const closeUserModalBtns = document.querySelectorAll('#userModal .close-modal, #cancelUserBtn');
            
            closeUserModalBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    userModal.style.display = 'none';
                });
            });
            
            // Modal preview laporan
            const reportPreviewModal = document.getElementById('reportPreviewModal');
            const closeReportPreviewButtons = document.querySelectorAll('#reportPreviewModal .close-modal, #closePreview');
            
            closeReportPreviewButtons.forEach(button => {
                button.addEventListener('click', function() {
                    reportPreviewModal.style.display = 'none';
                });
            });
            
            // Download dari modal preview
            document.getElementById('downloadReportModal').addEventListener('click', function() {
                showMessage('Mengunduh laporan...', 'info');
                
                setTimeout(() => {
                    showMessage('Laporan berhasil diunduh!', 'success');
                    reportPreviewModal.style.display = 'none';
                }, 1500);
            });
            
            // Modal konfirmasi
            const confirmModal = document.getElementById('confirmModal');
            const closeConfirmModalBtns = document.querySelectorAll('#confirmModal .close-modal, #confirmModalNo');
            
            closeConfirmModalBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    confirmModal.style.display = 'none';
                });
            });
            
            // Tutup modal ketika klik di luar konten modal
            window.addEventListener('click', function(event) {
                if (event.target === document.getElementById('userModal')) {
                    userModal.style.display = 'none';
                }
                if (event.target === document.getElementById('reportPreviewModal')) {
                    reportPreviewModal.style.display = 'none';
                }
                if (event.target === document.getElementById('confirmModal')) {
                    confirmModal.style.display = 'none';
                }
            });
        }
        
        function showConfirmModal(title, message, yesCallback) {
            document.getElementById('confirmModalTitle').textContent = title;
            document.getElementById('confirmModalMessage').textContent = message;
            document.getElementById('confirmModal').style.display = 'flex';
            
            // Setup event listener untuk tombol Yes
            const yesBtn = document.getElementById('confirmModalYes');
            yesBtn.onclick = function() {
                yesCallback();
                document.getElementById('confirmModal').style.display = 'none';
            };
        }
        
        // ============================================
        // FUNGSI UTILITAS
        // ============================================
        
        function updateProfileInfo() {
            if (!currentUser) return;
            
            document.getElementById('profileUsername').value = currentUser.username;
            document.getElementById('profileFullName').value = currentUser.fullName;
            document.getElementById('profileEmail').value = currentUser.email;
            document.getElementById('profileRole').value = roleDisplayNames[currentUser.role];
            
            // Update last activity
            const lastActivity = currentUser.lastLogin ? 
                `Terakhir login: ${currentUser.lastLogin}` : 
                'Belum ada aktivitas tercatat';
            document.getElementById('lastActivityText').textContent = lastActivity;
        }
        
        function updateSettings(reset = false) {
            if (reset) {
                // Reset ke nilai default
                document.getElementById('defaultForecastMethod').value = 'holt-winters';
                document.getElementById('defaultForecastPeriod').value = 12;
                document.getElementById('confidenceLevel').value = 95;
                document.getElementById('dataRetention').value = 24;
                
                document.getElementById('emailNotifications').checked = true;
                document.getElementById('forecastAlerts').checked = true;
                document.getElementById('dataChangeAlerts').checked = false;
                document.getElementById('reportFrequency').value = 'monthly';
            }
            
            // Update system info
            document.getElementById('totalDataCount').textContent = historicalData.length;
            document.getElementById('activeUserCount').textContent = users.filter(u => u.status === 'active').length;
            document.getElementById('lastSystemUpdate').textContent = new Date().toLocaleDateString('id-ID');
        }
        
        // Fungsi-fungsi utilitas lainnya tetap sama seperti sebelumnya
        // (showEmptyTableState, populateDataTable, addDataToTable, editData, cancelEditMode, deleteData, 
        // updateProductionData, updateDashboardStats, formatMonth, getReportTypeName, showMessage, dll.)
        
        // Implementasi fungsi-fungsi tersebut sama seperti sebelumnya
        // Untuk menghemat ruang, saya tidak menulis ulang semua fungsi tersebut
        
        function showMessage(message, type) {
            // Hapus pesan sebelumnya
            const existingMessage = document.querySelector('.message-notification');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // Buat pesan baru
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-notification`;
            const bgColor = type === 'success' ? '#4caf50' : 
                           type === 'info' ? '#2196f3' : 
                           type === 'warning' ? '#ff9800' : '#f44336';
            const icon = type === 'success' ? 'fa-check-circle' : 
                        type === 'info' ? 'fa-info-circle' : 
                        type === 'warning' ? 'fa-exclamation-triangle' : 'fa-exclamation-circle';
            
            messageDiv.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; z-index: 1000; background-color: ${bgColor}; color: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 10px; min-width: 300px; max-width: 400px;">
                    <i class="fas ${icon}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(messageDiv);
            
            // Hapus pesan setelah 3 detik
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 3000);
        }
        
        function getMethodInfo(method) {
            const methodInfo = {
                'moving-average': 'Moving Average: Metode sederhana dengan rata-rata bergerak untuk data dengan pola stabil.',
                'exponential-smoothing': 'Exponential Smoothing: Memberikan bobot lebih besar pada data terbaru dengan faktor smoothing yang dapat disesuaikan.',
                'linear-regression': 'Regresi Linear: Mengidentifikasi hubungan linear antara waktu dan produksi untuk proyeksi masa depan.',
                'holt-winters': 'Holt-Winters: Metode yang memperhitungkan trend dan musiman dalam data, cocok untuk data dengan pola berulang.',
                'arima': 'ARIMA: Metode statistik canggih yang memodelkan autokorelasi dalam data untuk peramalan jangka pendek dan menengah.',
                'machine-learning': 'Machine Learning: Menggunakan algoritma machine learning untuk peramalan yang lebih akurat.'
            };
            
            return methodInfo[method] || 'Informasi metode tidak tersedia.';
        }
        
        // Fungsi-fungsi lainnya yang diperlukan dari kode sebelumnya
        // Untuk menghemat ruang, implementasi lengkapnya sama seperti sebelumnya
    </script>
</body>
</html>